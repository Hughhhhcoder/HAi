# Hai 心理健康支持平台（FastAPI + Vue 3）

**临床辅助级别的智能心理健康平台**

提供 **10 个专业心理咨询 AI 角色**，具备**专业知识增强系统（RAG）**、**长期记忆系统**和 **AI 自动生成专业报告**。AI 会基于真实心理学知识回答，越来越了解用户，并在每次测评后生成临床级别的专业评估报告。包含完整版 192 题国际标准心理测评、AI 个性化对话、每日打卡和积分激励。已完整容器化，支持一键启动。

---

## ✨ 核心特性

### 🧠 专业 AI 系统
- **10 个专业心理 AI 角色**：基于真实心理学流派（人本主义、CBT、正念、积极心理学、EFT、创伤疗愈等）
- **专业知识增强（RAG）**：所有 AI 具备 25+ 条真实心理学知识（CBT、正念、积极心理学、创伤疗愈等），回答基于专业理论
- **长期记忆系统**：AI 自动记住用户的性格、困扰、目标、触发因素等，对话越多越了解用户
- **个性化对话**：每次回复基于「用户画像 + 专业知识 + 对话历史」三位一体
- **多模态支持**：支持图片上传（最大 50MB）和 AI 视觉理解

### 📊 专业测评系统
- **10 个国际标准量表（完整版192题）**：覆盖情绪、人际、自我认知、职场、创伤等 5 大领域
- **所有量表均为完整版**：不使用简化版，确保最高的专业性和准确性
- **智能评分引擎**：支持总分、平均分、分量表、反向计分 4 种评分方式
- **多维度评估**：IRI-28（4维度）、SCS-26（6维度）、PCL-5（DSM-5 四症状簇）等

### 🤖 AI 专业报告（NEW）
- **自动生成详细评估报告**：每次测评后自动调用 AI 生成专业心理评估报告（1000+ 字）
- **临床标准**：基于 DSM-5、ICD-11 等国际诊断标准
- **报告内容包含**：
  - 测评结果总结（50-80字）
  - 详细心理学解读（200-300字）
  - 专业心理健康建议（150-200字）
  - 积极资源与优势识别（80-120字）
- **温暖且专业**：避免标签化和病理化，强调伦理边界

### 🔄 实时画像更新（NEW）
- **测评结果自动同步**：完成测评后，系统自动提取关键洞察更新用户画像
- **智能提取维度**：
  - 情绪困扰（抑郁、焦虑、压力等级）
  - 人际模式（依恋风格、共情能力）
  - 自我认知（自尊水平、自我同情）
  - 职业状态（倦怠程度、耗竭维度）
  - 创伤应激（PTSD 症状簇）
  - 积极资源（优势、应对能力）
- **AI 对话实时感知**：AI 自动读取最新测评状态，提供更个性化支持

### 🧠 智能生活计划生成（NEW）
- **主要基于作息和偏好的智能计划**：根据用户填写的作息时间和个人偏好生成个性化恢复计划
  - 作息分析：智能评估作息合理性，提供专业作息建议
  - 偏好定制：深度解析用户偏好，生成针对性建议（运动、学习、社交、娱乐等）
  - 智能阶段判断：自动确定恢复阶段（危机干预/稳定改善/持续优化）
  - 重点关注领域：自动识别作息规律、运动健康、社交关系、焦虑管理等关键领域
  - 优先级评估：基于测评结果和画像信息确定计划优先级
- **次要参考用户画像的个性化建议**：
  - 基于主要困扰提供专业建议（焦虑、抑郁、睡眠等）
  - 发挥个人优势（坚持性、学习能力、社交优势等）
  - 应用现有应对策略（正念练习、运动疗法、寻求支持等）
  - 整合测评数据和打卡状态

### 📝 每日打卡与生活计划画像同步（NEW）
- **每日打卡智能分析**：自动分析用户的心情、睡眠、任务完成情况
  - 心情模式识别：开心、平静、焦虑、沮丧、愤怒、疲惫等情绪状态分析
  - 睡眠质量评估：计算平均睡眠时长，识别睡眠不足/正常/过多模式
  - 任务领域分析：智能识别工作、健康、社交等不同领域的活动模式
- **生活计划深度解析**：从用户制定的康复计划中提取关键信息
  - 关注领域识别：焦虑管理、情绪调节、压力管理、睡眠改善、社交技能等
  - 应对策略分析：正念练习、运动疗法、自我反思、目标设定、寻求支持等
  - 个人优势挖掘：坚持性、学习能力、自我管理、乐观态度等特质识别
- **实时画像更新**：所有数据自动同步到用户画像，AI 获得更全面的用户信息

### 🤖 AI 对话与角色（更新）
- 前端 `AiRolesFixed.vue` 通过 `GET /api/ai/roles` 动态加载真实角色
- 后端 `POST /api/ai/chat` 支持 JSON 请求体：`{ user_id, role_id, message, image_url?, image_data_url? }`
- 前端调用统一为 `/api/ai/chat`（不再拼接 roleId 于路径）
- 若后端暂不可用，前端回退少量内置角色保证可用

### 🎨 企业级前端（NEW）
- **现代化设计系统**：完整的 Tailwind 配置（50+ 颜色、30+ 动画、10+ 工具类）
- **高级组件库**：可复用的 Button（8变体×5尺寸）和 Card（5变体）组件
- **Dashboard 主页**：数据可视化、任务管理、活动时间线
- **现代化登录页**：分屏设计、浮动粒子效果、玻璃态卡片
- **流畅动画系统**：GPU 加速、60fps 流畅体验
- **完美响应式**：桌面/平板/移动端全面适配

### 📝 其他功能
- **每日打卡**：记录心情和睡眠，积分激励
- **生活计划**：作息管理和康复计划生成

---

## 🎯 10 个专业心理 AI 角色

| 角色 | 流派/方法 | 专长 | 适合问题 |
|------|----------|------|---------|
| 温暖倾听者·艾米 | 人本主义疗法 | 无条件积极关注、共情倾听 | 需要倾诉、被理解、情感支持 |
| 认知教练·理查德 | 认知行为疗法 (CBT) | 识别认知扭曲、改变负面思维 | 负面思维、焦虑、抑郁 |
| 正念导师·静心 | 正念减压 (MBSR) | 正念冥想、觉察当下 | 压力管理、情绪调节、焦虑 |
| 积极心理师·阳光 | 积极心理学 | 发现优势、培养幸福感 | 提升幸福感、找到意义 |
| 情绪专家·心涟 | 情绪聚焦疗法 (EFT) | 情绪觉察与调节 | 情绪困扰、情绪表达困难 |
| 创伤疗愈师·守护 | 创伤知情护理 | PTSD、创伤疗愈 | 创伤后应激、安全感缺失 |
| 青少年导师·星辰 | 青少年心理学 | 青春期发展、学业压力 | 青春期困扰、同伴关系 |
| 职场心理顾问·行远 | 组织心理学 | 职业倦怠、职场适应 | 工作压力、职业倦怠 |
| 关系咨询师·和鸣 | Gottman 方法 | 亲密关系、沟通技巧 | 伴侣冲突、沟通问题 |
| 生命意义探索者·启明 | 存在主义疗法 | 意义追寻、存在性焦虑 | 意义危机、人生迷茫 |

---

## 📊 心理测评系统（完整版192题）

### 🔵 情绪与心境类 (4个，50题)
- **PHQ-9** - 抑郁自评量表（9题）
- **GAD-7** - 焦虑自评量表（7题）
- **PSS-14** - 压力知觉量表（14题，含反向计分）
- **PANAS** - 积极消极情绪量表（20题，双维度：积极情绪+消极情绪）

### 🟣 人际关系类 (2个，64题)
- **ECR-36** - 亲密关系体验量表（36题）
  - 焦虑维度（18题）：评估对被抛弃的恐惧
  - 回避维度（18题）：评估亲密恐惧
  - 可识别：安全型、焦虑型、回避型、恐惧型依恋
- **IRI-28** - 人际反应指数（28题，共情能力评估）
  - 观点采择（7题）：理解他人立场的能力
  - 幻想（7题）：投入虚构世界的倾向
  - 共情关注（7题）：关心他人的温暖感受
  - 个人痛苦（7题）：他人痛苦引发的焦虑

### 🟢 自我认知类 (2个，36题)
- **RSES** - 罗森伯格自尊量表（10题）
- **SCS-26** - 自我同情量表（26题，Kristin Neff 原创）
  - 自我友善（5题）
  - 自我批判（5题，反向）
  - 普遍人性（4题）
  - 孤立（4题，反向）
  - 正念（4题）
  - 过度认同（4题，反向）

### 🟠 职场与学业类 (1个，22题)
- **MBI-22** - Maslach 职业倦怠量表（22题）
  - 情绪耗竭（9题）：精疲力竭的程度
  - 去人格化/玩世不恭（5题）：对工作冷漠疏离
  - 个人成就感（8题）：工作效能感

### 🔴 创伤与应激类 (1个，20题)
- **PCL-5** - PTSD 检查表（20题，DSM-5 完整版）
  - 侵入症状（5题）：闯入性记忆、噩梦
  - 回避症状（2题）：回避创伤相关提示
  - 认知情绪负性改变（7题）：负面信念、情绪麻木
  - 警觉性改变（6题）：过度警觉、易受惊吓

### 📈 量表统计
- **总题目数**：192题（所有均为国际标准完整版）
- **总测评时间**：约 60-90 分钟（全部完成）
- **单个量表**：2-12 分钟不等
- **信效度**：所有量表均经过严格的心理测量学验证
- **应用范围**：广泛应用于临床诊断、心理咨询、科学研究
- **权威来源**：
  - PSS-14: Cohen & Williamson, 1988
  - ECR-36: Brennan, Clark & Shaver, 1998
  - IRI-28: Mark H. Davis, 1983
  - SCS-26: Kristin Neff, 2003
  - MBI-22: Christina Maslach, 1981
  - PCL-5: Weathers et al., 2013

---

## 🚀 快速开始（Docker）

### 1) 准备环境变量
创建 `.env` 文件（可选，有默认值）：

```env
# 数据库配置
MYSQL_USER=hai
MYSQL_PASSWORD=hai123
MYSQL_DB=aidb

# AI 配置（必须配置 API Key 才能使用 AI 报告生成）
AI_USE_EXTERNAL=true
AI_API_URL=https://api.gpt.ge/v1/chat/completions
AI_API_KEY=your-api-key-here
AI_MODEL=gpt-4o-all
AI_IMAGE_INPUT_MODE=data_url
```

### 2) 一键启动
```bash
docker compose up -d --build
```

### 3) 访问地址
- **前端**：`http://localhost:5174`
- **后端**：`http://localhost:8000`
- **API 文档**：`http://localhost:8000/docs`

### 4) 测试账号
系统会自动创建测试账号：
- **用户名**：`admin`
- **密码**：`admin123`

---

## 🎓 专业知识增强系统（RAG）

每个 AI 角色都配备了专业心理学知识库，对话时自动检索相关知识：

### 知识库内容（25+ 条）
| 类别 | 知识条目 |
|------|---------|
| **CBT 认知行为疗法** | 认知扭曲识别、行为激活疗法、暴露疗法、苏格拉底式提问 |
| **正念与接纳** | 正念减压（MBSR）、正念呼吸、ACT 接纳承诺疗法 |
| **积极心理学** | PERMA 幸福模型、性格优势、感恩练习 |
| **情绪聚焦疗法** | 情绪觉察三步骤、空椅子技术 |
| **创伤疗愈** | 创伤知情护理、接地技术、稳定化技术 |
| **人际关系** | Gottman 四骑士、非暴力沟通、共情与积极关注 |
| **专题知识** | 完美主义、拖延心理学、自我同情、抑郁/焦虑认知模型 |

### 工作原理
1. **用户发送消息** → 系统提取关键词（如"焦虑"、"完美主义"、"失眠"）
2. **智能检索** → 检索该角色的专属知识 + 通用知识（top 3）
3. **知识注入** → 将知识注入 AI 系统提示词：`【专业知识参考】+ 具体内容 + 来源`
4. **AI 生成回复** → 基于专业知识 + 用户画像 + 对话历史
5. **记录与优化** → 记录知识使用情况，持续优化检索效果

这确保 AI 的回答有真实心理学理论支撑，而非随意编造。

---

## 💭 长期记忆系统

AI 会自动从对话中提取并记住关键信息：

### 记忆类型
| 类型 | 示例 | 重要性 |
|------|------|--------|
| **性格特质** | "我是一个完美主义者，对自己要求很高" | 6-7 |
| **困扰** | "最近工作压力很大，经常失眠" | 7-8 |
| **目标** | "希望能够学会放松，改善睡眠质量" | 9 |
| **触发因素** | "每当看到工作邮件就会焦虑" | 8 |
| **资源** | "我很擅长倾听朋友的烦恼" | 5-6 |

### 用户画像整合
每次对话时，AI 都会看到完整的用户画像：

```
作息：07:00起床，23:00睡觉
偏好：喜欢正念冥想

近期心理测评：
PHQ9=中重度(18分)
  └ 情绪低落=严重
GAD7=中度焦虑(12分)
PSS14=高压力(42分)

近期心情：焦虑, 疲惫, 烦躁

主要困扰：抑郁(中重度), 焦虑(中度), 工作压力大
优势：共情能力强, 善于理解他人
触发因素：工作邮件、截止日期

重要记忆：
- 是一个完美主义者，对自己要求很高
- 最近工作压力很大，经常失眠到凌晨2点
- 希望学会放松技巧
```

这让 AI 的回复更加个性化和贴近用户真实情况。

---

## 🤖 AI 专业报告生成（NEW）

### 功能亮点
- ✅ **自动生成**：每次测评完成后自动调用 AI 生成专业报告（无需额外操作）
- ✅ **临床标准**：基于 DSM-5、ICD-11 等国际诊断标准
- ✅ **资深专家定位**：AI 扮演临床心理学家和心理测评专家
- ✅ **结构化报告**：包含总结、解读、建议、积极资源四大部分
- ✅ **温暖专业**：避免标签化和病理化，强调伦理边界

### 报告结构
```
## 测评结果总结（50-80字）
用专业但易懂的语言概述测评结果的整体情况。

## 详细解读（200-300字）
- 分析得分的心理学意义
- 解释可能的心理状态或特征
- 分析各维度的相互关系
- 基于 DSM-5 或心理学理论进行解读

## 心理健康建议（150-200字）
- 针对性的自我照顾建议
- 具体可操作的改善方法
- 推荐的心理技巧或练习
- 寻求专业帮助的时机

## 积极资源与优势（80-120字）
- 识别来访者的心理资源
- 鼓励性的反馈
- 强化积极的应对方式
```

### 伦理声明
每份报告都包含明确声明：
> "此报告由 AI 心理学家生成，仅供参考，不能替代专业诊断。如有需要，请寻求专业心理咨询。"

---

## 🔄 测评结果实时画像更新（NEW）

### 智能洞察提取

系统会根据不同量表类型，自动提取关键洞察并更新用户画像：

| 测评类型 | 提取维度 | 更新字段 | 触发条件 | 示例 |
|---------|---------|---------|---------|------|
| PHQ-9/GAD-7/PSS-14 | 情绪困扰 | `main_concerns` | 中度及以上 | "抑郁(中重度), 焦虑(中度)" |
| ECR-36 | 依恋风格 | `coping_patterns` | 任何等级 | "依恋风格: 高焦虑, 中回避" |
| RSES/SCS-26 | 自我认知 | `core_traits` | 低/中等 | "自尊水平: 低自尊" |
| MBI-22 | 职业倦怠 | `main_concerns` | 中/高耗竭 | "职业倦怠(高耗竭)" |
| PCL-5 | 创伤应激 | `triggers` | 中/重度 | "存在创伤后应激症状(中度PTSD)" |
| PANAS | 积极情绪 | `strengths` | 高分 | "积极情绪丰富" |
| IRI-28 | 共情能力 | `strengths` | 高共情 | "共情能力强, 善于理解他人" |

### AI 对话实时感知
更新后的画像会立即注入到 AI 的系统提示词中，让 AI 能：
- ✅ 实时感知用户最新心理状态
- ✅ 提供更个性化和针对性的建议
- ✅ 避免重复询问已知信息
- ✅ 关注用户的优势和资源

---

## 🛠️ 技术栈

### 后端
- **FastAPI**：现代高性能 Web 框架
- **SQLAlchemy**：ORM 和数据库操作
- **MySQL**：关系型数据库
- **Redis**：对话上下文缓存
- **httpx**：异步 HTTP 客户端（用于 AI API 调用）

### 前端
- **Vue 3**：渐进式 JavaScript 框架（Composition API）
- **Vite**：极速开发构建工具
- **Tailwind CSS（企业级配置）**：
  - 50+ 自定义颜色变量（5主题×10层级）
  - 30+ 专业动画（fadeIn, slide, float, gradient等）
  - 10+ 自定义工具类（glass, text-gradient等）
- **高级组件库**：Button（8变体×5尺寸）、Card（5变体）
- **Markdown 渲染**：marked + DOMPurify
- **现代化UI**：Dashboard、玻璃态、粒子效果

### 基础设施
- **Docker & docker-compose**：容器化编排
- **Nginx**：前端静态托管与反向代理
- **命名卷**：MySQL 数据和上传文件持久化

---

## 📖 API 文档

### 用户相关
- `POST /user/register` - 注册
- `POST /user/login` - 登录

### AI 对话
- `GET /ai/roles` - 获取所有 AI 角色
- `POST /ai/chat` - 发送消息
- `POST /ai/stream` - 流式对话（SSE）
- `DELETE /ai/clear` - 清空历史

### 心理测评
- `GET /psych/categories` - 获取所有分类和量表
- `GET /psych/questionnaire?test_type=PHQ9` - 获取问卷
- `POST /psych/submit` - 提交测评（自动生成 AI 报告）
- `GET /psych/history?user_id=1` - 获取历史记录
- `GET /psych/report/{record_id}` - 获取单个测评完整报告

### 生活管理
- `POST /plan/profile` - 更新作息信息
- `POST /plan/generate` - 生成康复计划
- `POST /checkin/daily` - 每日打卡
- `GET /checkin/history` - 打卡历史

### 积分系统
- `GET /rewards/points?user_id=1` - 查询积分
- `GET /rewards/history?user_id=1` - 积分历史

### 专业知识
- `GET /knowledge/list` - 浏览知识库
- `GET /knowledge/stats` - 知识库统计
- `POST /knowledge/add` - 添加新知识

---

## 🧪 开发与调试

### 查看日志
```bash
docker compose logs -f backend
docker compose logs -f frontend
```

### 重新构建
```bash
docker compose build --no-cache
docker compose up -d
```

### 重跑数据库初始化
```bash
docker compose run --rm seed
```

### 进入容器调试
```bash
docker compose exec backend bash
docker compose exec mysql mysql -uroot -proot aidb
```

### 停止并清理
```bash
docker compose down
docker compose down -v  # 同时删除数据卷
```

---

## 🔒 生产部署注意事项

### 安全配置
- ✅ 修改所有默认密码（MySQL、Redis）
- ✅ 配置 AI API Key 到环境变量，不要硬编码
- ✅ **用户数据加密**：长期记忆和测评结果包含敏感信息，需加密存储
- ✅ 增加 JWT 认证，限制敏感接口访问
- ✅ 配置 HTTPS 和 SSL 证书

### 性能优化
- ✅ 配置 Nginx 缓存和 gzip 压缩
- ✅ Redis 连接池和持久化配置
- ✅ MySQL 查询优化和索引
- ✅ 前端资源 CDN 加速

### 合规与伦理
- ✅ **添加免责声明**：AI 仅供心理健康支持，不能替代专业心理治疗
- ✅ **用户隐私保护**：遵守 GDPR、个人信息保护法
- ✅ **数据保留政策**：明确数据保留期限和删除机制
- ✅ **危机干预机制**：检测自杀/自伤风险，提供紧急资源

---

## 📝 变更日志

请查看 [CHANGELOG.md](./CHANGELOG.md) 了解详细的版本更新记录。

最新重大更新：
- ✅ **2025-10-16**：AI 专业报告自动生成 + 测评结果实时同步用户画像
- ✅ **2025-10-16**：升级到完整版量表（192题）
- ✅ **2025-10-15**：心理测评系统扩展（10个专业量表）
- ✅ **2025-10-14**：AI 心理健康专业化升级（10个角色+长期记忆+专业知识）

---

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

---

## 📄 许可证

本项目仅供学习和研究使用。如需商业使用，请联系作者获取授权。

---

## ⚠️ 免责声明

**重要提示**：
1. 本平台提供的 AI 心理健康支持和测评结果仅供参考，**不能替代专业心理咨询或临床诊断**。
2. 如果您正在经历严重的心理困扰、自杀或自伤念头，请立即拨打心理危机热线或前往专业医疗机构：
   - 🇨🇳 **全国心理援助热线**：12320
   - 🇨🇳 **北京心理危机研究与干预中心**：010-82951332
3. AI 生成的报告和建议基于心理学理论和国际标准，但不应作为唯一的决策依据。
4. 平台会尽力保护用户隐私和数据安全，但请勿在对话中透露过于敏感的个人信息（如身份证号、银行卡号等）。

---

**让 AI 成为你的心理健康伙伴** 💙
