# Hai 心理健康支持平台（FastAPI + Vue 3）

专业的心理健康 AI 支持平台，提供 **10 个专业心理咨询 AI 角色**，具备**专业知识增强系统**和**长期记忆系统**，AI 会基于真实心理学知识回答，并越来越了解用户。包含用户登录、AI 个性化对话、心理测评、每日打卡和积分激励。已完整容器化，支持一键启动。

## 核心特性
- 🎓 **专业知识增强（RAG）**：所有 AI 具备 25+ 条真实心理学知识（CBT、正念、积极心理学、创伤疗愈等），回答基于专业理论
- 🧠 **10 个专业心理 AI 角色**：基于真实心理学流派（人本主义、CBT、正念、积极心理学、EFT、创伤疗愈等）
- 💭 **长期记忆系统**：AI 自动记住用户的性格、困扰、目标等，对话越多越了解用户
- 🎯 **个性化对话**：每次回复基于「用户画像 + 专业知识 + 对话历史」三位一体
- 🖼️ **多模态支持**：支持图片上传（最大 50MB）和识别
- 📊 **专业心理测评**：10 个国际标准量表，覆盖情绪、人际、自我认知、职场、创伤等 5 大领域
- 📝 **每日打卡**：记录心情和睡眠，积分激励

## 技术栈
- 后端：FastAPI、SQLAlchemy、MySQL、Redis
- 前端：Vue 3 + Vite + Tailwind CSS
- 构建与部署：Docker、docker-compose、Nginx（前端静态托管与 /api 反向代理）

## 目录结构
```
backend/           # FastAPI 源码与依赖
frontend/          # Vue 3 源码
uploads/           # 运行时上传目录（容器卷挂载）
docker-compose.yml # 编排 MySQL/Redis/Backend/Frontend/Seed
```

## 10 个专业心理 AI 角色

| 角色 | 专长 | 适合问题 |
|------|------|---------|
| 温暖倾听者·艾米 | 人本主义疗法 | 需要倾诉、被理解 |
| 认知教练·理查德 | 认知行为疗法 (CBT) | 负面思维、焦虑抑郁 |
| 正念导师·静心 | 正念减压 (MBSR) | 压力管理、情绪调节 |
| 积极心理师·阳光 | 积极心理学 | 寻找优势、提升幸福感 |
| 情绪专家·心涟 | 情绪聚焦疗法 (EFT) | 情绪困扰、情绪调节 |
| 创伤疗愈师·守护 | 创伤知情护理 | 创伤后应激、安全感 |
| 青少年导师·星辰 | 青少年心理学 | 青春期困扰、学业压力 |
| 职场心理顾问·行远 | 组织心理学 | 职业倦怠、职场压力 |
| 关系咨询师·和鸣 | Gottman 方法 | 亲密关系、沟通问题 |
| 生命意义探索者·启明 | 存在主义疗法 | 意义危机、存在性焦虑 |

## 快速开始（Docker）
1) 准备环境变量（可选，默认值见 compose）
- 如需自定义，请创建 `.env` 并填入：
```env
# 数据库
MYSQL_USER=hai
MYSQL_PASSWORD=hai123
MYSQL_DB=aidb

# AI 配置
AI_USE_EXTERNAL=true
AI_API_URL=https://api.gpt.ge/v1/chat/completions
AI_API_KEY=your-api-key
AI_MODEL=gpt-4o-all
AI_IMAGE_INPUT_MODE=data_url
```

2) 一键启动
```bash
docker compose up -d --build
```
- 前端：`http://localhost:5174`
- 后端：`http://localhost:8000`
- 接口文档：`http://localhost:8000/docs`

3) 初始化数据
- 编排中包含 `seed` 服务，会在后端启动后执行 `app.core.init_db`：
  - 创建所有数据库表（包括用户记忆和洞察表）
  - 插入 10 个专业心理 AI 角色
  - 创建测试账号：`admin / admin123`

## 开发说明
- 前端容器使用 Nginx 静态托管，`/api` 反代至 `backend:8000`
- 前端运行时 API 基地址：`/api`，可通过 `VITE_API_BASE` 覆盖（见 `src/api/index.js`）
- 后端上传目录 `/app/uploads` 已挂载命名卷 `backend_uploads`

## 常用命令
- 查看日志
```
docker compose logs -f backend
```
- 重新构建
```
docker compose build --no-cache && docker compose up -d
```
- 重跑初始化（按需）
```
docker compose run --rm seed
```
- 停止并清理
```
docker compose down
```

## 测试与自检
- 健康检查：`GET /ping` → `{ "msg": "pong" }`
- 登录：`POST /user/login`（使用 admin/admin123）
- AI 角色：`GET /ai/roles` → 返回 10 个专业角色
- 心理测评分类：`GET /psych/categories` → 返回 5 大分类和 10 个量表
- 心理问卷：`GET /psych/questionnaire?test_type=PHQ9` 或 `PSS10`、`PANAS`、`ECR12` 等
- 打卡：`POST /checkin/daily`

前端提供 `ApiTest` 页面便于快速验证。

## 心理测评系统（10 个专业量表）

### 🔵 情绪与心境类 (4个)
- **PHQ-9** - 抑郁自评量表（9题）
- **GAD-7** - 焦虑自评量表（7题）
- **PSS-10** - 压力知觉量表（10题，含反向题）
- **PANAS** - 积极消极情绪量表（20题，双维度）

### 🟣 人际关系类 (2个)
- **ECR-12** - 亲密关系体验量表（依恋风格）
- **IRI** - 人际反应指数（共情能力）

### 🟢 自我认知类 (2个)
- **RSES** - 罗森伯格自尊量表
- **SCS** - 自我同情量表

### 🟠 职场与学业类 (1个)
- **MBI-GS** - 职业倦怠量表（三维度评估）

### 🔴 创伤与应激类 (1个)
- **PCL-5** - PTSD 检查表（符合 DSM-5 标准）

所有量表均为国际公认的标准化工具，经过严格的信效度验证。

## 专业知识增强系统说明
每个 AI 角色都配备了专业心理学知识库，对话时自动检索相关知识：

### 知识库内容（25+ 条）
- **CBT 认知行为疗法**：认知扭曲、行为激活、暴露疗法
- **正念与接纳**：正念减压、正念呼吸、ACT 接纳承诺疗法
- **积极心理学**：PERMA 幸福模型、性格优势、感恩练习
- **情绪聚焦疗法**：情绪觉察、空椅子技术
- **创伤疗愈**：创伤知情护理、接地技术、稳定化技术
- **人际关系**：Gottman 四骑士、非暴力沟通
- **其他专题**：完美主义、拖延、自我同情、抑郁/焦虑认知模型

### 工作原理（RAG）
1. 用户发送消息 → 系统提取关键词（如"焦虑"、"完美主义"）
2. 检索该角色的专属知识 + 通用知识（top 3）
3. 将知识注入 AI 系统提示词：`【专业知识参考】+ 知识内容`
4. AI 基于专业知识 + 用户画像 + 对话历史回答
5. 记录知识使用情况，持续优化

这确保 AI 的回答有真实心理学理论支撑，而非随意编造。

## 长期记忆系统说明
AI 会自动从对话中提取并记住：
- **性格特质**："我是一个完美主义者"
- **困扰**："最近工作压力很大，经常失眠"
- **目标**："希望能够学会放松"
- **触发因素**："每当看到工作邮件就会焦虑"

每次对话时，AI 都会看到完整的用户画像，包括：
- 作息信息
- 心理测评结果
- 近期打卡心情
- 重要记忆

这让 AI 的回复更加个性化和贴近用户情况。

## 生产注意事项
- 将数据库账号、密钥配置到外部安全存储，不使用默认值
- 配置持久化存储（当前已挂载 MySQL 与上传卷）
- **用户数据加密**：长期记忆包含敏感信息，需加密存储
- 增加认证授权（JWT/Cookie），限制敏感接口
- **添加免责声明**：AI 仅供心理健康支持，不能替代专业心理治疗
- 配置 HTTPS 与反向代理（生产 Nginx/Traefik）

## 变更日志
请见 `CHANGELOG.md`，记录了容器化改造及后续更新。
